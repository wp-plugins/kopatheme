/**
 * Kopa Framework Admin Dynamic Sidebar JS
 * Author: Kopatheme
 * Copyright: 2014 Kopatheme
 * License: GPLv2 or later
 * Used localized variable: kopa_sidebar_attributes_l10n
 */
jQuery(document).ready(function(a){function b(){var c=a(this),d=c.siblings(".kopa_sidebar_add_button");return c.val()?(d.removeClass("kopa_button_inactive"),void 0):(d.addClass("kopa_button_inactive"),void 0)}function c(b){b.preventDefault();var c=a(this),d=c.find(".kopa_sidebar_title_action");d.hasClass("kopa_action_close")?d.removeClass("kopa_action_close"):d.addClass("kopa_action_close"),c.siblings(".kopa_sidebar_body").slideToggle("fast")}function d(b){b.preventDefault();var c=a(this),d=c.parents(".kopa_sidebar_body"),e=d.siblings(".kopa_sidebar_header"),f=e.find(".kopa_sidebar_title_action");d.slideUp("fast"),f.removeClass("kopa_action_close")}function e(b){b.preventDefault();var e=a(this),g=e.siblings(".kopa_sidebar_add_field"),h=g.val(),j=e.data("registered-sidebars")+1,k=e.data("register-sidebar-ids"),l="sidebar-"+j,m=e.data("name"),n=e.data("container-id"),o=a("#"+n),p="";if(!e.hasClass("kopa_button_inactive")&&""!==h){for(;k.search(l)>=0;)j++,l="sidebar-"+j;p='<li class="kopa_sidebar">',p+='<div class="kopa_sidebar_header">',p+='<div class="kopa_sidebar_title_action"></div>',p+="<strong>"+h+"</strong>",p+="</div>",p+='<div class="kopa_sidebar_body">';var q=kopa_sidebar_attributes_l10n.attributes;p+='<label><input class="kopa_sidebar_advanced_settings" type="checkbox"> '+kopa_sidebar_attributes_l10n.advanced_settings+"</label>";for(var r in q)p+='<div class="kopa_sidebar_'+r+'">',p+='<input type="text" class="kopa_sidebar kopa_sidebar_attr" name="'+m+"["+l+"]["+r+']" id="kopa_sidebar_'+j+"_"+r+'" '+("name"===r?'value="'+h+'"':"")+' placeholder="'+q[r]+'">',p+="</div>";p+='<div class="kopa_sidebar_control_actions">',p+='<a class="kopa_sidebar_delete_button" href="#">'+kopa_sidebar_attributes_l10n.remove+"</a>",p+=" | ",p+='<a class="kopa_sidebar_close_button" href="#">'+kopa_sidebar_attributes_l10n.close+"</a>",p+='<span class="spinner"></span>',p+="</div>",p+="</div>",p+="</li>",o.append(p);var s=o.children("li:last");viewportTop=a(window).scrollTop(),viewportBottom=a(window).scrollTop()+a(window).height(),sidebarBounds=s.offset(),$newElementHeader=s.children(".kopa_sidebar_header"),$newElementBody=s.children(".kopa_sidebar_body"),$newElementTitleAction=s.find(".kopa_sidebar_title_action"),$newElementCloseButton=s.find(".kopa_sidebar_close_button"),$newElementDeleteButton=s.find(".kopa_sidebar_delete_button"),$newElementAdvancedButton=s.find(".kopa_sidebar_advanced_settings"),$newElementTitleAction.addClass("kopa_action_close"),viewportBottom<sidebarBounds.top?a("html, body").animate({scrollTop:s.offset().top-130},{duration:200,complete:function(){$newElementBody.slideDown("fast")}}):$newElementBody.slideDown("fast"),e.data("registered-sidebars",j),g.val(""),e.addClass("kopa_button_inactive"),$newElementHeader.on("click",c),$newElementCloseButton.on("click",d),$newElementDeleteButton.on("click",f),$newElementAdvancedButton.on("click",i)}}function f(b){b.preventDefault();var c=a(this),d=c.data("sidebar-id"),e="<strong>"+kopa_sidebar_attributes_l10n.confirm_message+"</strong>";d?a.ajax({url:kopa_sidebar_attributes_l10n.ajax_url,type:"POST",data:{action:"kopa_remove_sidebar",sidebar_id:d},beforeSend:function(){c.siblings(".spinner").show()},success:function(b){c.siblings(".spinner").hide(),b=a.parseJSON(b);var d=b.allow_delete,f=b.warnings,h=b.errors,i="";d?(f.push(e),i=f.join("<br>"),g("confirm",c,kopa_sidebar_attributes_l10n.warning,i)):(i+=h.join("<br>"),g("alert",c,kopa_sidebar_attributes_l10n.error,i))}}):g("confirm",c,kopa_sidebar_attributes_l10n.info,e)}function g(b,c,d,e){var f=a("#kopa_modal_info"),g=f.find("#kopa_modal_confirm"),i=g.find("#kopa_confirm_ok"),j=g.find("#kopa_confirm_cancel");"confirm"!=b?g.hide():g.show(),f.find(".kopa_modal_info").empty().append(e),tb_show(d,"#TB_inline?width=450&height=420&inlineId=kopa_modal_info"),i.off("click",h).on("click",{allowDelete:!0,selector:c},h),j.off("click",h).on("click",{allowDelete:!1,selector:c},h)}function h(b){b.preventDefault();var c=b.data.allowDelete,d=b.data.selector;c&&d.parents(".kopa_sidebar").slideUp("fast",function(){a(this).remove()}),tb_remove()}function i(){var c=a(this);c.parent().siblings(".kopa_sidebar_before_widget, .kopa_sidebar_after_widget, .kopa_sidebar_before_title, .kopa_sidebar_after_title").slideToggle("fast")}a(".kopa_sidebar_sortable").sortable({handle:".kopa_sidebar_header"}),a(".kopa_sidebar_add_field").on("keyup",b),a(".kopa_sidebar_add_button").on("click",e),a(".kopa_sidebar_header").on("click",c),a(".kopa_sidebar_close_button").on("click",d),a(".kopa_sidebar_delete_button").on("click",f),a(".kopa_sidebar_advanced_settings").on("click",i)});