/**
 * Kopa Framework Admin JS
 * Author: Kopatheme
 * Copyright: 2014 Kopatheme
 * License: GPLv2 or later
 */
jQuery(document).ready(function(a){function b(){a(".kopa_tab_pane").hide();var b="";"undefined"!=typeof localStorage&&(b=localStorage.getItem("kopa_active_tab")),""!=b&&a(b).length?(a(b+"_tab").addClass("kopa_nav_active"),a(b).show()):(a(".kopa_nav_tabs li").first().addClass("kopa_nav_active"),a(".kopa_tab_pane").first().show()),a(".kopa_nav_tabs li a").on("click",function(a){a.preventDefault()}),a(".kopa_nav_tabs li").on("click",function(){var b=a(this),c=b.children(".kopa_nav_title"),d=a(c.attr("href"));"undefined"!=typeof localStorage&&localStorage.setItem("kopa_active_tab",c.attr("href")),b.addClass("kopa_nav_active").siblings().removeClass("kopa_nav_active"),d.show().siblings().hide()})}function f(b,f){var h=a("#"+f).val(),i="kopa_style_link_"+f,j=f+"_preview",k=f+"_style",n="kopa_typeface_"+a("#"+f).parents(".kopa_section").attr("id"),o=void 0,p=!1,q=!1,r=!1;if(kopa_system_fonts.indexOf(h)>=0?p=!0:kopa_google_font_families.indexOf(h)>=0?q=!0:e.indexOf(h)>=0&&(r=!0),r){var s=h,t="",u=e.indexOf(h),v=d[u],w=v.woff,x=v.ttf,y=v.svg,z=v.eot,A="";return a("#"+k).attr("disabled","disabled"),a("#"+j).fadeIn(),A+='<style class="'+n+'">'+"\n",A+="@font-face {\n",A+='font-family: "'+s+'";'+"\n",A+="src: ",z&&(A+='url("'+z+'");'+"\n",A+='src: url("'+z+'?#iefix") format("embedded-opentype")'),w&&z?A+=',\nurl("'+w+'") format("woff")':w&&(A+='url("'+w+'") format("woff")'),x&&(w||z)?A+=',\nurl("'+x+'") format("truetype")':x&&(A+='url("'+x+'") format("truetype")'),y?a.get(y,function(b){t=a(b).find("font").attr("id"),A+=x||w||z?',\nurl("'+y+"#"+t+'") format("svg")':'url("'+y+"#"+t+'") format("svg")',A+=";\n",A+="}\n",A+="</style>\n",a("."+n).remove(),a("head").append(A),a("#"+j).css("font-family",'"'+s+'"').css("font-style","").css("font-weight","")}):(A+=";\n",A+="}\n",A+="</style>\n",a("."+n).remove(),a("head").append(A),a("#"+j).css("font-family",'"'+s+'"').css("font-style","").css("font-weight","")),void 0}if(a("#"+k).removeAttr("disabled"),a(b).attr("id")===f&&q){var u=kopa_google_font_families.indexOf(h);u>=0&&(o=kopa_google_fonts[u],o.category&&(c=o.category))}if(h)if(a("#"+j).fadeIn(),"none"!==h&&"Select a font"!==h)if(p){var B=a("#"+k).val();if(a(b).attr("id")===f){a("#"+k+" option").remove();var C=["regular","italic","bold","bolditalic"],D="";for(var u in C)D=g(C[u]),D&&a("#"+k).append('<option value="'+C[u]+'">'+D+"</option>");B&&C.indexOf(B)>=0?a("#"+k).val(B).find('option[value="'+B+'"]').attr("selected","selected"):C.indexOf("regular")>=0?(B="regular",a("#"+k).val("regular").find('option[value="regular"]').attr("selected","selected")):(B=C[0],a("#"+k).val(B).find("option:first").attr("selected","selected"))}"regular"===B&&(B="normal"),a("#"+j).css("font-family",h),a("#"+j).css("font-weight",B.replace("italic","")),B.indexOf("italic")>=0?a("#"+j).css("font-style","italic"):a("#"+j).css("font-style","normal")}else{a("."+i).remove();var E=h.replace(/\s+/g,"+"),B=a("#"+k).val();if(void 0!==o){a("#"+k+" option").remove();var C=o.variants,D="";for(var u in C)D=g(C[u]),D&&a("#"+k).append('<option value="'+C[u]+'">'+D+"</option>");B&&C.indexOf(B)>=0?a("#"+k).val(B).find('option[value="'+B+'"]').attr("selected","selected"):C.indexOf("regular")>=0?(B="regular",a("#"+k).val("regular").find('option[value="regular"]').attr("selected","selected")):(B=C[0],a("#"+k).val(B).find("option:first").attr("selected","selected"))}"regular"===B&&(B="400"),a("head").append('<link href="http://fonts.googleapis.com/css?family='+E+":"+B+'" rel="stylesheet" type="text/css" class="'+i+'">'),a("#"+j).css("font-family",h+","+c),a("#"+j).css("font-weight",B.replace("italic","")),B.indexOf("italic")>=0?a("#"+j).css("font-style","italic"):a("#"+j).css("font-style","normal")}else a("#"+j).css("font-family",""),a("#"+j).fadeOut()}function g(a){var b={};for(var c in kopa_font_styles)if(b=kopa_font_styles[c],b.style===a)return b.label;return!1}function h(a,b){var c=jQuery(a),d=c.val(),e=b+"_preview";jQuery("#"+e).css("font-size",d+"px")}function i(){var a=jQuery(this),b=a.data("main-id");if(void 0!==b){var c=a.val()?a.val():a.data("default-color"),d=b+"_preview";c?jQuery("#"+d).css("color",c):jQuery("#"+d).css("color","inherit")}}function m(b,c){b.preventDefault();var d=a(this),e=c.find(".kopa_upload"),f=e.data("type"),g=l.indexOf(f),h={title:d.data("choose"),button:{text:d.data("update"),close:!1}};k=c,f&&(-1===g&&l.push(f),h.library={type:f}),kopaframework_modals&&(j=kopaframework_modals[g]),j?j.open():(j=wp.media.frames.kopaframework_upload=wp.media(h),j.on("select",function(){var b=j.state().get("selection").first();j.close(),k.find(".kopa_upload").val(b.attributes.url),"image"==b.attributes.type&&k.find(".kopa_screenshot").empty().hide().removeClass("kopa_hide").append('<img src="'+b.attributes.url+'"><a class="kopa_remove_image">'+kopa_admin_l10n.remove+"</a>").slideDown("fast"),k.find(".kopa_upload_button").unbind().addClass("kopa_remove_file").removeClass("kopa_upload_button").val(kopa_admin_l10n.remove),k.find(".kopa_remove_image, .kopa_remove_file").on("click",function(){n(a(this).closest(".kopa_section"))})}),kopaframework_modals.push(j)),j.open()}function n(b){b.find(".kopa_remove_image").hide(),b.find(".kopa_upload").val(""),b.find(".kopa_screenshot").slideUp("fast"),b.find(".kopa_remove_file").unbind().addClass("kopa_upload_button").removeClass("kopa_remove_file").val(kopa_admin_l10n.upload),a(".kopa_section_upload .kopa_upload_notice").length>0&&a(".kopa_upload_button").remove(),b.find(".kopa_upload_button").on("click",function(b){m(b,a(this).closest(".kopa_section"))})}function o(){var c=a(this),d=c.parents(".kopa_controls"),e=d.find(".kopa_custom_font_list"),g=(d.find(".kopa_custom_font_item"),c.data("name")),h=c.data("orders").toString(),i=[];itemCount=0,newItem="",""!==h&&(i=h.split(","),i=a.map(i,function(a){return parseInt(a)})),i.length&&(itemCount=Math.max.apply(null,i),itemCount+=1),i.push(itemCount),h=i.join(","),c.data("orders",h),i=e.find(".kopa_custom_font_order").map(function(){var a=this.value;return a=a.replace(/\D/g,""),a=parseFloat(a)}).get(),newItem+='<div class="kopa_custom_font_item">',newItem+='<div class="kopa_custom_font_top">',newItem+='<div class="kopa_custom_font_title_action">',newItem+="</div>",newItem+='<div class="kopa_custom_font_title">',newItem+="<strong>Custom Font "+(itemCount+1)+"</strong>",newItem+="</div>",newItem+="</div>",newItem+='<div class="kopa_custom_font_inside kopa_hide">';for(var j in kopa_custom_font_attributes){var k=kopa_custom_font_attributes[j],l="kopa_custom_font_item_"+j,n=!1,o="",s="";"name"===j&&k.value&&(s=k.value+" "+(itemCount+1)),"upload"===k.type&&(l+=" kopa_upload"),k.required&&(n=!0),k.mimes&&(o=k.mimes),newItem+='<div class="kopa_section"><div class="kopa_controls">',newItem+='<input class="'+l+'" type="text" name="'+g+"["+itemCount+"]["+j+']" placeholder="'+k.placeholder+'" '+(n?"required ":"")+'data-type="'+o+'" value="'+s+'">',"upload"===k.type&&(newItem+='<input class="kopa_upload_button kopa_button button" type="button" value="'+kopa_admin_l10n.upload+'">'),newItem+="</div></div>"}newItem+='<div class="kopa_custom_font_control_actions">',newItem+='<a class="kopa_custom_font_remove" href="#">'+kopa_sidebar_attributes_l10n.remove+"</a>",newItem+=" | ",newItem+='<a class="kopa_custom_font_close" href="#">'+kopa_sidebar_attributes_l10n.close+"</a>",newItem+="</div>",newItem+="</div>",newItem+="</div>",e.append(newItem);var t=e.children(".kopa_custom_font_item:last"),u=t.find(".kopa_custom_font_title_action"),v=t.find(".kopa_upload_button");u.addClass("kopa_action_close"),t.children(".kopa_custom_font_inside").slideDown("fast"),t.on("click",".kopa_custom_font_top",p),t.on("click",".kopa_custom_font_close",q),t.on("click",".kopa_custom_font_remove",r),v.on("click",function(b){m(b,a(this).closest(".kopa_section"))})}function p(){var c=a(this),d=c.find(".kopa_custom_font_title_action"),e=c.siblings(".kopa_custom_font_inside");d.hasClass("kopa_action_close")?d.removeClass("kopa_action_close"):d.addClass("kopa_action_close"),e.slideToggle("fast")}function q(b){b.preventDefault();var c=a(this),d=c.parents(".kopa_custom_font_inside"),e=d.siblings(".kopa_custom_font_top"),f=e.find(".kopa_custom_font_title_action");f.removeClass("kopa_action_close"),d.slideUp("fast")}function r(b){b.preventDefault();var c=a(this),d=c.parents(".kopa_custom_font_item");confirm(kopa_admin_l10n.confirm_delete)&&d.slideUp("fast",function(){d.remove()})}Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){var c;if(null==this)throw new TypeError('"this" is null or not defined');var d=Object(this),e=d.length>>>0;if(0===e)return-1;var f=+b||0;if(1/0===Math.abs(f)&&(f=0),f>=e)return-1;for(c=Math.max(f>=0?f:e-Math.abs(f),0);e>c;){if(c in d&&d[c]===a)return c;c++}return-1}),jQuery(".kopa_fold").click(function(){var b=".kopa_fold_"+this.id;a(b).slideToggle("fast")}),setTimeout(function(){a(".kopa_message.updated.fade, .kopa_message.error.fade").fadeOut("slow")},3e3),a(".kopa_color").wpColorPicker(),a(".kopa_nav_title").length>0&&b(),a("#kopa_options_wrap .kopa_sidebar_menu_mobile_icon").on("click",function(){a("#kopa_options_wrap ul.kopa_nav_tabs").toggle()}),a(window).resize(function(){a(this).width()>980&&a("#kopa_options_wrap ul.kopa_nav_tabs").show().removeAttr("style")});var c="sans-serif",d=[],e=[];jQuery(".kopa_custom_font_item").each(function(){var a=jQuery(this),b=a.find(".kopa_custom_font_item_name").val(),c=a.find(".kopa_custom_font_item_woff").val(),f=a.find(".kopa_custom_font_item_ttf").val(),g=a.find(".kopa_custom_font_item_svg").val(),h=a.find(".kopa_custom_font_item_eot").val();d.push({woff:c,ttf:f,svg:g,eot:h}),e.push(b)}),jQuery(".kopa_select_font, .kopa_select_font_style").each(function(){var a=jQuery(this).data("main-id");f(this,a)}),jQuery(".kopa_select_font, .kopa_select_font_style").change(function(){var a=jQuery(this).data("main-id");f(this,a)}),jQuery(".kopa_select_font_size").each(function(){var a=jQuery(this).data("main-id");h(this,a)}),jQuery(".kopa_select_font_size").on("keyup change",function(){var a=jQuery(this).data("main-id");h(this,a)}),jQuery(".kopa_select_font_color").wpColorPicker({change:i,clear:i,palettes:!1}),jQuery(".kopa_select_font_color").each(i);var j,k,l=[];kopaframework_modals=[],a(".kopa_remove_image, .kopa_remove_file").on("click",function(){n(a(this).closest(".kopa_section"))}),a(".kopa_upload_button").click(function(b){m(b,a(this).closest(".kopa_section"))}),a(".kopa_custom_font_list").sortable({items:".kopa_custom_font_item",handle:".kopa_custom_font_top"}),a(".kopa_add_font_button").on("click",o),a(".kopa_custom_font_top").on("click",p),a(".kopa_custom_font_close").on("click",q),a(".kopa_custom_font_remove").on("click",r),a(".kopa_reset").on("click",function(){return confirm(kopa_admin_l10n.confirm_reset)}),a(".kopa_import").on("click",function(){return confirm(kopa_admin_l10n.confirm_import)})});